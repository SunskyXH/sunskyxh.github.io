<!DOCTYPE html>
<html lang=en,zh-cn,default>
  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="description" content="这里什么都没有">
  <meta name="keywords" content="undefined">
  
    <link rel="icon" href="">
  
  <title>GraphQL+Relay初探</title>
  <link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/atom-one-light.css">
<link rel="stylesheet" href="/css/font-awesome.min.css">
  <script src="/js/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
</head>
<body>
  <div class="wrapper">
    <div class="default_title">
        <img src="/imgs/mycomputer.png" />
        <h1>香香鸡的小窝</h1>
    </div>
    <ul class="topbar">
    
        <li>
        <a href="/" class="item-link">首页</a>
        </li>
    
        <li>
        <a href="/about" class="item-link">关于</a>
        </li>
    
    </ul>
    <div class="tag_list">
    <ul id="tag-list">
        <li><a href="/" ><img src="/imgs/disk.png" />(C:)</a>
        <ul>
        
            <li>
            <a href="/tags/GraphQL" title="GraphQL" rel="1">
                <img src="/imgs/folder.ico" />
                GraphQL
            </a>
            </li>    
        
            <li>
            <a href="/tags/Relay" title="Relay" rel="1">
                <img src="/imgs/folder.ico" />
                Relay
            </a>
            </li>    
        
            <li>
            <a href="/tags/Vue" title="Vue" rel="3">
                <img src="/imgs/folder.ico" />
                Vue
            </a>
            </li>    
        
            <li>
            <a href="/tags/javascript" title="javascript" rel="3">
                <img src="/imgs/folder.ico" />
                javascript
            </a>
            </li>    
        
            <li>
            <a href="/tags/Typescript" title="Typescript" rel="1">
                <img src="/imgs/folder.ico" />
                Typescript
            </a>
            </li>    
        
            <li>
            <a href="/tags/redux-saga" title="redux-saga" rel="1">
                <img src="/imgs/folder.ico" />
                redux-saga
            </a>
            </li>    
        
            <li>
            <a href="/tags/redux-observable" title="redux-observable" rel="1">
                <img src="/imgs/folder.ico" />
                redux-observable
            </a>
            </li>    
        
            <li>
            <a href="/tags/React" title="React" rel="1">
                <img src="/imgs/folder.ico" />
                React
            </a>
            </li>    
        
            <li>
            <a href="/tags/Preact" title="Preact" rel="1">
                <img src="/imgs/folder.ico" />
                Preact
            </a>
            </li>    
        
            <li>
            <a href="/tags/Virtual DOM" title="Virtual DOM" rel="1">
                <img src="/imgs/folder.ico" />
                Virtual DOM
            </a>
            </li>    
        
            <li>
            <a href="/tags/Reason" title="Reason" rel="1">
                <img src="/imgs/folder.ico" />
                Reason
            </a>
            </li>    
        
            <li>
            <a href="/tags/OCaml" title="OCaml" rel="1">
                <img src="/imgs/folder.ico" />
                OCaml
            </a>
            </li>    
        
            <li>
            <a href="/tags/bucklescript" title="bucklescript" rel="1">
                <img src="/imgs/folder.ico" />
                bucklescript
            </a>
            </li>    
        
        </ul>
    </ul>
    </div>
    <div class="post_list">
    <ul>
        
            <li>
            <a href="/2017/02/22/GraphQL-Relay-first-explore/">
            <img src="/imgs/file.ico" />
                GraphQL+Relay初探
            </a>
            </li>
        
            <li>
            <a href="/2016/08/20/The-State-of-Vue/">
            <img src="/imgs/file.ico" />
                The State of Vue(自译)
            </a>
            </li>
        
            <li>
            <a href="/2017/04/05/6-reasons-why-javascripts-async-await-blows-promises-away/">
            <img src="/imgs/file.ico" />
                Async/Await胜过Promise的6个理由（自译）
            </a>
            </li>
        
            <li>
            <a href="/2018/03/12/dose-refactoring-vue-project-into-typescript-deserved/">
            <img src="/imgs/file.ico" />
                有必要将Vue项目重构到Typescript吗?
            </a>
            </li>
        
            <li>
            <a href="/2017/03/30/i-dont-know-js/">
            <img src="/imgs/file.ico" />
                我不懂的js集合
            </a>
            </li>
        
            <li>
            <a href="/2016/09/10/vue-directive-to-highlight-code/">
            <img src="/imgs/file.ico" />
                vue自定义指令实现Highlight.js高亮代码
            </a>
            </li>
        
            <li>
            <a href="/2017/02/26/preact-virtual-DOM-algorithm-explore/">
            <img src="/imgs/file.ico" />
                Preact Virtual DOM算法探究
            </a>
            </li>
        
            <li>
            <a href="/2017/12/17/reason-intro/">
            <img src="/imgs/file.ico" />
                Reason简介
            </a>
            </li>
        
    </ul>
    </div>

    <div class="post_total">
        
            <div class="left">8 object(s)</div>
        
        <div class="right">&nbsp;</div>
    </div>
</div>
  <div class="content">
    <div class="post_title">
      <img src="/imgs/file.png" />
      <h1>GraphQL+Relay初探</h1>
      <a href="/"><div class="btn"><span class="fa fa-times"></span></div></a>
      <div class="btn btn_max"><span class="fa fa-window-maximize"></span></div>
      <div class="btn"><span class="fa fa-window-minimize"></span></div>
    </div>
    <ul class="topbar">
      <li>Wed Feb 22 2017 00:32:09 GMT+0800</li>
    </ul>
    <div class="post_content">
      <h3 id="GraphQL简介"><a href="#GraphQL简介" class="headerlink" title="GraphQL简介"></a>GraphQL简介</h3><p><img src="http://olu3hx27t.bkt.clouddn.com/image/graphql.png" alt=""><br>GraphQL是Facebook开源的一套用于API的查询语言和runtime，其比较明显的特色在于用一次请求拿到所有想要的数据，并且返回的查询结果与想要查询的格式一致。同时也强调了强类型，减少冗余。</p>
<h3 id="Query-Mutation"><a href="#Query-Mutation" class="headerlink" title="Query/Mutation"></a>Query/Mutation</h3><p>(后文大部分例子皆来自/魔改自官方文档)<br>拿一个如下的简单的query来分析，这里的hero，name或者friends叫做<code>field</code>，field会返回type中定义的类型。</p>
<ul>
<li>field能通过例如<code>hero(name: &quot;R2-D2&quot;)</code>这样的方式来添加参数</li>
<li>多个同级同类型的field能通过例如<code>empireHero: hero</code> 来指定别名</li>
<li>多个filed要查询相同类型的数据时，可以用碎片(fragments)来复用相同的查询条件</li>
<li>当遇到多个查询需要带上不同的参数时，可以使用变量 </li>
<li><p>可以用指令(directive)去动态的改变query的结构和形状，如<code>@include(if: Boolean)</code> <code>@skip(if: Boolean)</code></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">query Hero($episode: Episode, $withFriends: Boolean!) &#123;</div><div class="line">  hero(episode: $episode) &#123;</div><div class="line">    name</div><div class="line">    friends @include(if: $withFriends) &#123;</div><div class="line">      name</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>GraphQL不只是提供了获得数据的方式，也提供了Mutation去修改服务端的数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">mutation CreateReviewForEpisode($ep: Episode!, $review: ReviewInput!) &#123;</div><div class="line">  createReview(episode: $ep, review: $review) &#123;</div><div class="line">    stars</div><div class="line">    commentary</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>GraphQL的schemas能定义接口和结合(union)的type，因此当query中的field在schema中对应这些type时，你需要内联碎片(inline fragments)去获取混合(concrete)type之下的数据。</p>
</li>
<li>当不知道服务器返回的type时，可以用meta field去代替,即在field前加上<code>__</code><br>例如 我们要查询带有’an’的数据，同时也不知道返回的数据的type，如果这个返回的数据的type是Droid，则会同时返回primaryFunction，如果为Human类型，则会返回height。此外返回结果里的__typename就会是这个查询结果的type的名字了(此例中可能为Human、Droid或者Starship)<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  search(text: &quot;an&quot;) &#123;</div><div class="line">    __typename</div><div class="line">    ... on Human &#123;</div><div class="line">      height</div><div class="line">    &#125;</div><div class="line">    ... on Droid &#123;</div><div class="line">      primaryFunction</div><div class="line">    &#125;</div><div class="line">    ... on Starship &#123;</div><div class="line">      name</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="Types-Schemas"><a href="#Types-Schemas" class="headerlink" title="Types/Schemas"></a>Types/Schemas</h3><p>上一节中提到了许多次type，<code>type</code>即我们想要查询的field的类型，用于描述我们想要的数据。属于schema中最基础的一类</p>
<p>每一个<code>GarphQL Service</code>定义了一系列的type用于完全描述一系列可能会被查询到的数据。当query来的时候，GraphQL Service会根据schema去验证并执行。</p>
<p>GraphQL Service可以用<code>任何语言</code>去编写。同时还有一种叫做”GraphQL schema language”的语言用于描述schema。</p>
<p>一个简单的定义名为Character的type的例子</p>
<ul>
<li>name，appearsIn和length为该type的field</li>
<li>field的type后面的!表示该field不可为null</li>
<li>appearsIn: [Episode]表示对应这个appearsIn对应的是一个Episode类型的数据的数组</li>
<li>schema中的参数必须有名字，等号前的为参数的type，后面的为默认值</li>
<li><p>一些基本的type：<code>Int</code> <code>Float</code> <code>String</code> <code>Boolean</code> <code>ID</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">type Character &#123;</div><div class="line">    name: String!</div><div class="line">    appearsIn: [Episode]!</div><div class="line">    height(unit: LengthUnit = METER): Float</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>纯量(scalar)：经常作为query的叶结点，例如最前面的query例子里的name。可以用scalar去声明一个纯量 <code>scalar Date</code></p>
</li>
<li><p>枚举(enum)：枚举是一种特殊的纯量，他被限制为一个特定允许值的集合。这个特性可以拿来做验证或者利用一个有限集合的值来在type系统之间传送，可以用如下方式声明,Episode一定会为NEWHOPE、EMPIRE、和JEDI其中之一</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">enum Episode &#123;</div><div class="line">  NEWHOPE</div><div class="line">  EMPIRE</div><div class="line">  JEDI</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>接口(interface)：像许多强类型语言一样，GraphQL也提供了接口，即包含了type必须实现的、确定的、field的集合的抽象的type。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">interface Character &#123;</div><div class="line">  id: ID!</div><div class="line">  name: String!</div><div class="line">  friends: [Character]</div><div class="line">  appearsIn: [Episode]!</div><div class="line">&#125;</div><div class="line">type Human implements Character &#123;</div><div class="line">  id: ID!</div><div class="line">  name: String!</div><div class="line">  friends: [Character]</div><div class="line">  appearsIn: [Episode]!</div><div class="line">  starships: [Starship]</div><div class="line">  totalCredits: Int</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>结合(union)：结合和接口非常类似，只是没有具体说明type之间的共同field，即没有将type的具体属性抽象出来</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">union SearchResult = Human | Droid | Starship</div></pre></td></tr></table></figure>
</li>
<li><p>输入(input)：当你可能要传递整个对象(例如参数为一个对象时)，需要指定这个对象的type，就可以使用input。简单的把type换成input即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">input ReviewInput &#123;</div><div class="line">  stars: Int!</div><div class="line">  commentary: String</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<p>上面就是GraphQL中一些基础概念，更加进阶的概念会在以后的文章中提到。</p>
<h3 id="GraphQL对比RESTful"><a href="#GraphQL对比RESTful" class="headerlink" title="GraphQL对比RESTful"></a>GraphQL对比RESTful</h3><p>一万个人心中有一万种RESTful，RESTful虽然简单易理解，但是在深入开发的过程中其难扩展的缺点逐渐暴露了出来。</p>
<p>例如前面官网上的例子，GraphQL会直接返回这样的结果<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attr">"data"</span>: &#123;</div><div class="line">        <span class="attr">"hero"</span>: &#123;</div><div class="line">            <span class="attr">"name"</span>: <span class="string">"Luke Skywalker"</span></div><div class="line">            <span class="string">"friends"</span>: [</div><div class="line">                &#123; <span class="attr">"name"</span>: <span class="string">"Han Solo"</span> &#125;,</div><div class="line">                &#123; <span class="attr">"name"</span>: <span class="string">"R2-D2"</span> &#125;,</div><div class="line">                &#123; <span class="attr">"name"</span>: <span class="string">"Leia Organa"</span> &#125;,</div><div class="line">            ]</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>而RESTful，可能有人会这样写<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">GET /hero/ </div><div class="line">#之后遍历返回的信息，并发送新请求</div><div class="line">GET /hero/加上前一次查询返回的name/friends/</div></pre></td></tr></table></figure></p>
<p>或者<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">GET /heros?extend_query=friends</div></pre></td></tr></table></figure></p>
<p>这种情景下，RESTful可能会去发送多次请求，或者把请求魔改得不直观。GraphQL恰恰能很好的解决这类问题。</p>
<p>同时我们也看到了，GraphQL在一定程度上，查询请求是不依赖url的，这也许意味着当系统要添加新的功能，同时需要的数据能用之前的数据组装，就不需要新的后台接口了。</p>
<p>此外，若是后台能将数据拆分，提供大量的原子数据接口的话，那么对于产品版本迅速迭代将是一件非常有意义的事情。</p>
<h3 id="Relay简介"><a href="#Relay简介" class="headerlink" title="Relay简介"></a>Relay简介</h3><p><img src="http://olu3hx27t.bkt.clouddn.com/image/relay.png" alt=""><br>Relay是一个用于构建数据驱动的React应用的框架，结合GraphQL可以实现用GraphQL声明需要的数据，Relay指明在什么时机用什么方法去获取数据。<br>Relay还能综合所有query，利用高效的网络请求去获取你恰好需要的数据，也能结合GraphQL的mutation去修改客户端/服务端上的数据，并且同时提供了自动化的连贯的数据更新机制和错误处理机制。</p>

    </div>
</div>
  <footer class="footer">
  <p> powered by hexo</p>
</footer>
<script>
  var max = document.getElementsByClassName("btn")[1];
  var min = document.getElementsByClassName("btn")[2];

  function maximize () {
    var post = document.getElementsByClassName("content")[0];
    var cont = document.getElementsByClassName("post_content")[0];
    var wid = window.innerWidth || document.documentElement.clientWidth || document.getElementsByTagName("body")[0].clientWidth;

    if (wid > 900) {
      widf = wid * 0.9;
      post.style.width = widf + "px";

      if (wid < 1400) {
        cont.style.width = "99%";
      } else {
        cont.style.width = "99.4%";
      }
    }
  }

  function minimize () {
    var post = document.getElementsByClassName("content")[0];
    var cont = document.getElementsByClassName("post_content")[0];
    var wid = window.innerWidth || document.documentElement.clientWidth || document.getElementsByTagName("body")[0].clientWidth;

    if ( wid > 900 ) {
      post.style.width = "800px";
      cont.style.width = "98.5%";
    }
  }

  max && max.addEventListener('click', maximize, false);
  min && min.addEventListener('click', minimize, false);

</script>
</body>
</html>